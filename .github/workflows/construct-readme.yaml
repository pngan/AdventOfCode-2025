# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: Construct README

permissions:
  contents: write

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: {}

jobs:
  build:

    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0
      - name: Ensure 7zip is installed
        if: runner.os == 'Windows'
        run: choco install 7zip -y
      - name: Extract Input from 7z Archive
        env:
          ARCHIVE_PASSWORD: ${{ secrets.ARCHIVEPASSWORD }}
        run: |
          # Navigate to the input directory
          Push-Location input
          
          # Extract the 7z archive
          $secretValue = $env:ARCHIVE_PASSWORD
          7z x .\Input.7z -p"$secretValue"
          
          # Return to the original directory
          Pop-Location
      - name: Setup .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '10.0.x'
      - name: Restore dependencies
        run: dotnet restore
      
      - name: Build
        run: dotnet build --configuration Release --no-restore

      - name: Run timing runner
        run: dotnet run --project AdventOfCode-2025.csproj --configuration Release --no-build

      - name: Commit README changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        shell: pwsh
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          try { git add README.md } catch { }
          $changes = git status --porcelain README.md
          if ($changes) {
            try { git commit -m "Update README timings" } catch { Write-Host "Commit failed" }
            try { git push origin HEAD:main } catch { Write-Host "Push failed" }
          } else {
            Write-Host "No README changes to commit"
          }


